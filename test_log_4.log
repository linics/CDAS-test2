============================= test session starts =============================
platform win32 -- Python 3.12.7, pytest-7.4.4, pluggy-1.0.0
rootdir: D:\githubfiles\CDAS-test2\CDAS-test2
plugins: anyio-4.12.0, langsmith-0.5.0
collected 4 items

tests\test_auth.py ..F.                                                  [100%]

================================== FAILURES ===================================
_________________________________ test_login __________________________________

client = <starlette.testclient.TestClient object at 0x000001FEEDC70860>

    def test_login(client: TestClient):
        # First register
        client.post(
            "/api/v2/auth/register",
            json={
                "username": "user1",
                "password": "password123",
                "name": "User One",
                "role": "student",
                "grade": 7,
                "class_name": "1"
            },
        )
    
        # Then login
        response = client.post(
            "/api/v2/auth/login",
            data={
                "username": "user1",
                "password": "password123"
            },
        )
        assert response.status_code == 200
        data = response.json()
        assert "access_token" in data
        assert data["token_type"] == "bearer"
>       assert data["role"] == "student"  # Assuming role is in token response based on backend code
E       KeyError: 'role'

tests\test_auth.py:62: KeyError
============================== warnings summary ===============================
C:\Users\linic\AppData\Roaming\Python\Python312\site-packages\PyPDF2\__init__.py:21
  C:\Users\linic\AppData\Roaming\Python\Python312\site-packages\PyPDF2\__init__.py:21: DeprecationWarning: PyPDF2 is deprecated. Please move to the pypdf library instead.
    warnings.warn(

app\api\v2\auth.py:41
  D:\githubfiles\CDAS-test2\CDAS-test2\app\api\v2\auth.py:41: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class UserResponse(BaseModel):

app\api\v2\subjects.py:22
  D:\githubfiles\CDAS-test2\CDAS-test2\app\api\v2\subjects.py:22: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class SubjectResponse(BaseModel):

app\api\v2\assignments.py:84
  D:\githubfiles\CDAS-test2\CDAS-test2\app\api\v2\assignments.py:84: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class AssignmentResponse(BaseModel):

app\api\v2\assignments.py:121
  D:\githubfiles\CDAS-test2\CDAS-test2\app\api\v2\assignments.py:121: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class GroupResponse(BaseModel):

app\api\v2\submissions.py:47
  D:\githubfiles\CDAS-test2\CDAS-test2\app\api\v2\submissions.py:47: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class SubmissionResponse(BaseModel):

app\api\v2\evaluations.py:51
  D:\githubfiles\CDAS-test2\CDAS-test2\app\api\v2\evaluations.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class EvaluationResponse(BaseModel):

app\main.py:33
  D:\githubfiles\CDAS-test2\CDAS-test2\app\main.py:33: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

C:\Users\linic\AppData\Roaming\Python\Python312\site-packages\fastapi\applications.py:4580
  C:\Users\linic\AppData\Roaming\Python\Python312\site-packages\fastapi\applications.py:4580: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED tests/test_auth.py::test_login - KeyError: 'role'
=================== 1 failed, 3 passed, 9 warnings in 0.24s ===================
